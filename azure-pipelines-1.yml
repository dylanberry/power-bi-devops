parameters:
  - name: PbixFileUrl
    type: string
    displayName: Pbix File Url

trigger: none

pool: default

steps:
- checkout: none

- powershell: Invoke-WebRequest -Uri '${{ parameters.PbixFileUrl }}' -OutFile '$(Build.BinariesDirectory)/sample.pbix'

- powershell: |
    C:\pbi-tools\pbi-tools.exe extract '$(Build.BinariesDirectory)/sample.pbix' -extractFolder '$(Build.ArtifactStagingDirectory)/sample' -modelSerialization Raw
    ls '$(Build.ArtifactStagingDirectory)/sample'
  displayName: 'Extract PBIX'

- publish: '$(Build.ArtifactStagingDirectory)/sample'
  artifact: 'sample.pbix'